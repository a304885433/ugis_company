(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-96652340"],{"88bc":function(e,t,n){(function(t){var n=1/0,r=9007199254740991,i="[object Arguments]",a="[object Function]",o="[object GeneratorFunction]",s="[object Symbol]",l="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();function d(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function m(e,t){var n=-1,r=e?e.length:0,i=Array(r);while(++n<r)i[n]=t(e[n],n,e);return i}function f(e,t){var n=-1,r=t.length,i=e.length;while(++n<r)e[i+n]=t[n];return e}var h=Object.prototype,p=h.hasOwnProperty,v=h.toString,g=u.Symbol,y=h.propertyIsEnumerable,b=g?g.isConcatSpreadable:void 0,w=Math.max;function k(e,t,n,r,i){var a=-1,o=e.length;n||(n=A),i||(i=[]);while(++a<o){var s=e[a];t>0&&n(s)?t>1?k(s,t-1,n,r,i):f(i,s):r||(i[i.length]=s)}return i}function x(e,t){return e=Object(e),j(e,t,function(t,n){return n in e})}function j(e,t,n){var r=-1,i=t.length,a={};while(++r<i){var o=t[r],s=e[o];n(s,o)&&(a[o]=s)}return a}function O(e,t){return t=w(void 0===t?e.length-1:t,0),function(){var n=arguments,r=-1,i=w(n.length-t,0),a=Array(i);while(++r<i)a[r]=n[t+r];r=-1;var o=Array(t+1);while(++r<t)o[r]=n[r];return o[t]=a,d(e,this,o)}}function A(e){return N(e)||C(e)||!!(b&&e&&e[b])}function _(e){if("string"==typeof e||G(e))return e;var t=e+"";return"0"==t&&1/e==-n?"-0":t}function C(e){return E(e)&&p.call(e,"callee")&&(!y.call(e,"callee")||v.call(e)==i)}var N=Array.isArray;function F(e){return null!=e&&S(e.length)&&!$(e)}function E(e){return q(e)&&F(e)}function $(e){var t=P(e)?v.call(e):"";return t==a||t==o}function S(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function P(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function q(e){return!!e&&"object"==typeof e}function G(e){return"symbol"==typeof e||q(e)&&v.call(e)==s}var I=O(function(e,t){return null==e?{}:x(e,m(k(t,1),_))});e.exports=I}).call(this,n("c8ba"))},aec7:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"max-width":"800px"}},[e.isMobile()?n("a-divider"):e._e(),e.mdl.id?n("div",[n("h3",[e._v("角色："+e._s(e.mdl.name))])]):e._e(),n("a-form",{attrs:{form:e.form,layout:e.isMobile()?"vertical":"horizontal"}},[n("a-form-item",{attrs:{label:"角色编码"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入角色编码!"}]}],expression:"[ 'name', {rules: [{ required: true, message: '请输入角色编码!' }]} ]"}],attrs:{placeholder:"请填写角色编码"}})],1),n("a-form-item",{attrs:{label:"角色名称"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["displayName",{rules:[{required:!0,message:"请输入角色名称!"}]}],expression:"[ 'displayName', {rules: [{ required: true, message: '请输入角色名称!' }]} ]"}],attrs:{placeholder:"请填写角色名称"}})],1),n("a-form-item",{attrs:{label:"备注说明"}},[n("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"[ 'description' ]"}],attrs:{row:3,placeholder:"请填写备注"}})],1),n("a-form-item",{attrs:{label:"拥有权限"}},e._l(e.permissions,function(t,r){return n("a-row",{key:r,attrs:{gutter:16}},[n("a-col",{attrs:{xl:4,lg:24}},[e._v("\n                    "+e._s(t.name)+"：\n                ")]),n("a-col",{attrs:{xl:20,lg:24}},[t.actionsOptions.length>0?n("a-checkbox",{attrs:{indeterminate:t.indeterminate,checked:t.checkedAll},on:{change:function(n){return e.onChangeCheckAll(n,t)}}},[e._v("\n                        全选\n                    ")]):e._e(),n("a-checkbox-group",{attrs:{options:t.actionsOptions},on:{change:function(n){return e.onChangeCheck(t)}},model:{value:t.selected,callback:function(n){e.$set(t,"selected",n)},expression:"permission.selected"}})],1)],1)}),1),n("a-button",{directives:[{name:"action",rawName:"v-action",value:["create","update"],expression:"['create','update']"}],staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")]),n("a-button",{attrs:{type:"default"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1)},i=[],a=(n("f559"),n("5d73")),o=n.n(a),s=(n("ac6a"),n("7f7f"),n("5176")),l=n.n(s),c=n("365c"),u=n("ac0d");var d=n("88bc"),m=n.n(d),f={name:"RoleEdit",mixins:[u["c"]],components:{},data:function(){return{form:this.$form.createForm(this),mdl:{},roles:[],permissions:[]}},created:function(){this.init()},methods:{init:function(){var e=this,t=this.$route.query.id;t=3,t?c["f"].GetRoleForEdit({id:t}).then(function(t){e.mdl=l()({},t.result),e.form.setFieldsValue({name:e.mdl.role.name,displayName:e.mdl.role.displayName,description:e.mdl.role.description}),e.loadPermissions(e.mdl.permissions,e.mdl.grantedPermissionNames)}):c["f"].GetAllPermissions().then(function(t){e.loadPermissions(t.result.items)})},test:function(){c["f"].GetRoleForEdit({id:2}).then(function(e){})},edit:function(e){var t=this;if(this.mdl=l()({},e),this.mdl.permissions&&this.permissions){var n={};this.mdl.permissions.forEach(function(e){n[e.permissionId]=e.actionEntitySet.map(function(e){return e.action})}),console.log("permissionsAction",n),this.permissions.forEach(function(e){var r=n[e.id];e.selected=r||[],t.onChangeCheck(e)}),console.log("this.permissions",this.permissions)}this.$nextTick(function(){t.form.setFieldsValue(m()(t.mdl,"id","name","status","describe"))}),console.log("this.mdl",this.mdl)},onChangeCheck:function(e){e.indeterminate=!!e.selected.length&&e.selected.length<e.actionsOptions.length,e.checkedAll=e.selected.length===e.actionsOptions.length},onChangeCheckAll:function(e,t){l()(t,{selected:e.target.checked?t.actionsOptions.map(function(e){return e.value}):[],indeterminate:!1,checkedAll:e.target.checked})},loadPermissions:function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var s,l=function(){var r=s.value,i=r.name.lastIndexOf(".");if(-1==i){var a=e.filter(function(e){return e.name.startsWith(r.name+".")}),o=t&&t.filter(function(e){return e.startsWith(r.name+".")})||[],l=a.length==o.length,c=o.length>0&&o.length<a.length;n.push({name:r.displayName,value:r.name,checkedAll:l,selected:o,indeterminate:c,actionsOptions:a.map(function(e){return{label:e.displayName,value:e.name}})})}},c=o()(e);!(r=(s=c.next()).done);r=!0)l()}catch(u){i=!0,a=u}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}this.permissions=n},save:function(){var e=this;this.form.validateFields(function(t,n){if(!t){var r=[],i=!0,a=!1,s=void 0;try{for(var l,u=o()(e.permissions);!(i=(l=u.next()).done);i=!0){var d=l.value;d.selected&&d.selected.length&&(r.push(d.value),r=r.concat(d.selected))}}catch(t){a=!0,s=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}n.permissions=r,e.mdl.role?(n.id=e.mdl.role.id,c["f"].Update(n).then(function(){e.$message.success("保存成功")})):c["f"].Create(n).then(function(){e.$message.success("保存成功")})}}),console.log(this.permissions)}}},h=f,p=n("2877"),v=Object(p["a"])(h,r,i,!1,null,"f7d1e4f0",null);t["default"]=v.exports}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-054d7112"],{"1add":function(e,t,r){"use strict";var n=r("770d"),i=r.n(n);i.a},"75fc":function(e,t,r){"use strict";var n=r("a745"),i=r.n(n);function a(e){if(i()(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var o=r("774e"),c=r.n(o),s=r("c8bb"),l=r.n(s);function u(e){if(l()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return c()(e)}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function f(e){return a(e)||u(e)||d()}r.d(t,"a",function(){return f})},"770d":function(e,t,r){},"774e":function(e,t,r){e.exports=r("d2d5")},a21f:function(e,t,r){var n=r("584a"),i=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},a356:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("a-card",{staticClass:"card",attrs:{title:"",bordered:!1}},[r("check-info",{ref:"checkInfoForm"})],1),r("a-card",{attrs:{title:""}},[r("check-item",{ref:"checkItemTable"})],1),r("footer-tool-bar",{style:{width:e.isSideMenu()&&e.isDesktop()?"calc(100% - "+(e.sidebarOpened?256:80)+"px)":"100%"}},[r("span",{staticClass:"popover-wrapper"},[r("a-popover",{attrs:{title:"表单校验信息",overlayClassName:"antd-pro-pages-forms-style-errorPopover",trigger:"click",getPopupContainer:function(e){return e.parentNode}}},[r("template",{slot:"content"},e._l(e.errors,function(t){return r("li",{key:t.key,staticClass:"antd-pro-pages-forms-style-errorListItem",on:{click:function(r){return e.scrollToField(t.key)}}},[r("a-icon",{staticClass:"antd-pro-pages-forms-style-errorIcon",attrs:{type:"cross-circle-o"}}),r("div",{},[e._v(e._s(t.message))]),r("div",{staticClass:"antd-pro-pages-forms-style-errorField"},[e._v(e._s(t.fieldLabel))])],1)}),0),e.errors.length>0?r("span",{staticClass:"antd-pro-pages-forms-style-errorIcon"},[r("a-icon",{attrs:{type:"exclamation-circle"}}),e._v(e._s(e.errors.length)+"\n        ")],1):e._e()],2)],1),r("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:e.loading},on:{click:e.validate}},[e._v("提交")]),r("a-button",{attrs:{type:"default"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1)},i=[],a=r("a4bb"),o=r.n(a),c=r("cebc"),s=r("5176"),l=r.n(s),u=r("f499"),d=r.n(u),f=r("5d73"),p=r.n(f),m=r("75fc"),h=r("5a70"),y=r("ac0d"),g=r("365c"),v=r("c1df"),b=r.n(v),k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-form",{staticClass:"form",attrs:{form:e.form},on:{submit:e.handleSubmit}},[r("a-table",{attrs:{columns:e.columns,dataSource:e.data,pagination:!1,loading:e.memberLoading},scopedSlots:e._u([{key:"poluTypeId",fn:function(t,n,i){return[r("a-select",{staticStyle:{width:"100%"},model:{value:n.poluTypeId,callback:function(t){e.$set(n,"poluTypeId",t)},expression:"record.poluTypeId"}},e._l(e.yaopinDicArr,function(t){return r("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)]}},{key:"concentration",fn:function(t,n,i){return[r("a-input-number",{staticStyle:{width:"100%"},attrs:{precision:2,step:1},model:{value:n.concentration,callback:function(t){e.$set(n,"concentration",t)},expression:"record.concentration"}})]}},{key:"operation",fn:function(t,n){return[r("a-popconfirm",{attrs:{title:"是否要删除此行？"},on:{confirm:function(t){return e.remove(n.key)}}},[r("a",[e._v("删除")])])]}}])}),r("a-button",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px"},attrs:{type:"dashed",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1)},I=[],F={name:"CheckItem",props:{yaopinDicArr:Array},components:{},data:function(){return{form:null,memberLoading:!1,columns:[{title:"因子",dataIndex:"poluTypeId",width:"20%",scopedSlots:{customRender:"poluTypeId"}},{title:"浓度",dataIndex:"concentration",width:"30%",scopedSlots:{customRender:"concentration"}},{title:"操作",key:"action",scopedSlots:{customRender:"operation"}}],data:[],errors:[]}},created:function(){this.form=this.$form.createForm(this)},methods:{edit:function(e){this.data=e.map(function(e,t){return e.key=t,e})},handleSubmit:function(e){e.preventDefault(),this.form.validateFields(function(e,t){})},handleAdd:function(){this.data.push({medTypeId:null,monthAmmount:null})},remove:function(e){this.data.splice(e,1)}}},w=F,D=(r("a3c7"),r("2877")),A=Object(D["a"])(w,k,I,!1,null,"7b54a110",null),T=A.exports,_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-form",{staticClass:"form",attrs:{form:e.form},on:{submit:e.handleSubmit}},[r("a-row",{staticClass:"form-row",attrs:{gutter:16}},[r("a-col",{attrs:{md:12,sm:24}},[r("a-form-item",{attrs:{label:"企业"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["companyId",{rules:[{required:!0,message:"请选择责任人"}]}],expression:"[ 'companyId',\n                      {rules: [{ required: true, message: '请选择责任人'}]}\n                    ]"}],attrs:{placeholder:"请选择企业"}},e._l(e.shoujiDicArr,function(t){return r("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1)],1),r("a-col",{attrs:{md:12,sm:24}},[r("a-form-item",{attrs:{label:"排查点位"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["chkPointId",{rules:[{required:!0,message:"请选择排查点位"}]}],expression:"[ 'chkPointId',\n                      {rules: [{ required: true, message: '请选择排查点位'}]}\n                    ]"}],attrs:{placeholder:"排查点位",mode:"multiple"}},e._l(e.dianweiDicArr,function(t){return r("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1)],1)],1)],1)},x=[],S={name:"TaskForm",props:{showSubmit:{type:Boolean,default:!1},dianweiDicArr:{type:Array}},data:function(){return{form:this.$form.createForm(this)}},methods:{handleSubmit:function(e){e.preventDefault()},edit:function(e){var t=this;this.form.resetFields(),setTimeout(function(){t.form.setFieldsValue(Object(c["a"])({},e))},50)}}},C=S,$=Object(D["a"])(C,_,x,!1,null,"0d8d6ed6",null),j=$.exports,O={name:"CompanyEditIndex",mixins:[y["b"],y["c"]],components:{FooterToolBar:h["a"],CheckItem:T,CheckInfo:j},data:function(){return{description:"录入排查数据",loading:!1,memberLoading:!1,errors:[],dicArr:[],yaopinDicArr:[],yinziDicArr:[],waterDicArr:[],paifangDicArr:[],shoujiDicArr:[],mdl:{}}},watch:{$route:function(e,t){}},created:function(){this.getDic(),this.getData()},methods:{getData:function(){var e=this,t=this.$route.query.id;t?g["b"].GetForEdit(t).then(function(t){e.mdl=t.result,e.mdl.companyInfo.dischargeDate&&(e.mdl.companyInfo.dischargeDate=b()(e.mdl.companyInfo.dischargeDate)),e.$refs.baseInfoForm.edit(e.mdl.companyInfo),e.$refs.waterInfoForm.edit(e.mdl.companyInfo),e.$refs.yaopinTable.edit(e.mdl.companyMedcineTypeList),e.$refs.poluTypeTable.edit(e.mdl.companyPoluTypeList)}):this.clearData()},clearData:function(){this.$nextTick(function(){})},getDic:function(){var e=this;g["c"].GetAllItem().then(function(t){e.dicArr=t.result,e.yaopinDicArr=e.dicArr.filter(function(e){return"yaopin"==e.typeCode}),e.yinziDicArr=e.dicArr.filter(function(e){return"yinzixinxi"==e.typeCode}),e.waterDicArr=e.dicArr.filter(function(e){return"feishuileixing"==e.typeCode}),e.shoujiDicArr=e.dicArr.filter(function(e){return"shoujifangshi"==e.typeCode}),e.paifangDicArr=e.dicArr.filter(function(e){return"paifangfangshi"==e.typeCode})})},handleSubmit:function(e){e.preventDefault()},handleChange:function(e,t,r){var n=Object(m["a"])(this.data),i=n.filter(function(e){return t===e.key})[0];i&&(i[r]=e,this.data=n)},checkTableData:function(e,t,r){if(!e||!e.length)return!0;var n=!0,i=!1,a=void 0;try{for(var o,c=p()(e);!(n=(o=c.next()).done);n=!0){var s=o.value;if(""===s[t]||null===s[t]||void 0===s[t])return this.$notification.warn({message:"提示",description:r}),!1}}catch(l){i=!0,a=l}finally{try{n||null==c.return||c.return()}finally{if(i)throw a}}return!0},getUploadFile:function(e){if(!e||!e.length)return null;var t=e.map(function(e){return e.response?e.response.result:e});return d()(t)},validate:function(){var e=this,t=this.$refs,r=t.baseInfoForm,n=t.waterInfoForm,i=t.yaopinTable,a=t.poluTypeTable,o=this.$notification,s=a.data,u=i.data;r.form.validateFields(function(t,i){if(i.licenseFile=e.getUploadFile(i.licenseFile),i.craftFile=e.getUploadFile(i.craftFile),i.pipeFile=e.getUploadFile(i.pipeFile),i.issSheetFile=e.getUploadFile(i.issSheetFile),t){var a=l()({},r.form.getFieldsError()),d=Object(c["a"])({},a);e.errorList(d)}else n.form.validateFields(function(t,r){if(t){var a=l()({},n.form.getFieldsError()),d=Object(c["a"])({},a);e.errorList(d)}else if(e.checkTableData(s,"poluTypeId","排查点位因子数据不完整，请调整！")&&e.checkTableData(u,"medTypeId","药品数据不完整，请调整！")){var f={companyInfo:l()(e.mdl.companyInfo,i,r),companyPoluTypeList:s,companyMedcineTypeList:u};return g["b"].SaveForEdit(f).then(function(t){e.$message.info("保存成功"),e.$router.go(-1)}).catch(function(e){o.error({message:"保存失败，请稍后重试！",description:e.message})})}})})},errorList:function(e){if(!e||0===e.length)return null;this.errors=o()(e).map(function(t){return e[t]?{key:t,message:e[t][0]}:null})},scrollToField:function(e){var t=document.querySelector('label[for="'.concat(e,'"]'));t&&t.scrollIntoView(!0)}}},L=O,E=(r("1add"),Object(D["a"])(L,n,i,!1,null,"08f1bb14",null));t["default"]=E.exports},a3c7:function(e,t,r){"use strict";var n=r("c1d7"),i=r.n(n);i.a},c1d7:function(e,t,r){},c8bb:function(e,t,r){e.exports=r("54a1")},f499:function(e,t,r){e.exports=r("a21f")}}]);
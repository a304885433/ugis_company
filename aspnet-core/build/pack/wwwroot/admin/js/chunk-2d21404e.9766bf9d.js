(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21404e"],{aec7:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"max-width":"800px"}},[e.isMobile()?n("a-divider"):e._e(),e.mdl.id?n("div",[n("h3",[e._v("角色："+e._s(e.mdl.name))])]):e._e(),n("a-form",{attrs:{form:e.form,layout:e.isMobile()?"vertical":"horizontal"}},[n("a-form-item",{attrs:{label:"角色编码"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入角色编码!"}]}],expression:"[ 'name', {rules: [{ required: true, message: '请输入角色编码!' }]} ]"}],attrs:{placeholder:"请填写角色编码"}})],1),n("a-form-item",{attrs:{label:"角色名称"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["displayName",{rules:[{required:!0,message:"请输入角色名称!"}]}],expression:"[ 'displayName', {rules: [{ required: true, message: '请输入角色名称!' }]} ]"}],attrs:{placeholder:"请填写角色名称"}})],1),n("a-form-item",{attrs:{label:"备注说明"}},[n("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"[ 'description' ]"}],attrs:{row:3,placeholder:"请填写备注"}})],1),n("a-form-item",{attrs:{label:"拥有权限"}},e._l(e.permissions,function(t,i){return n("a-row",{key:i,attrs:{gutter:16}},[n("a-col",{attrs:{xl:4,lg:24}},[e._v("\n                    "+e._s(t.name)+"：\n                ")]),n("a-col",{attrs:{xl:20,lg:24}},[t.actionsOptions.length>0?n("a-checkbox",{attrs:{indeterminate:t.indeterminate,checked:t.checkedAll},on:{change:function(n){return e.onChangeCheckAll(n,t)}}},[e._v("\n                        全选\n                    ")]):e._e(),n("a-checkbox-group",{attrs:{options:t.actionsOptions},on:{change:function(n){return e.onChangeCheck(t)}},model:{value:t.selected,callback:function(n){e.$set(t,"selected",n)},expression:"permission.selected"}})],1)],1)}),1),n("a-button",{directives:[{name:"action",rawName:"v-action",value:["create","update"],expression:"['create','update']"}],staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")]),n("a-button",{attrs:{type:"default"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1)},s=[],a=(n("f559"),n("ac4d"),n("8a81"),n("ac6a"),n("7f7f"),n("365c")),r=n("ac0d");var o={name:"RoleEdit",mixins:[r["c"]],components:{},data:function(){return{form:this.$form.createForm(this),mdl:{},roles:[],permissions:[]}},created:function(){this.init()},methods:{init:function(){var e=this,t=this.$route.query.id;t?a["f"].GetRoleForEdit({id:t}).then(function(t){e.mdl=Object.assign({},t.result),e.form.setFieldsValue({name:e.mdl.role.name,displayName:e.mdl.role.displayName,description:e.mdl.role.description}),e.loadPermissions(e.mdl.permissions,e.mdl.grantedPermissionNames)}):a["f"].GetAllPermissions().then(function(t){e.loadPermissions(t.result.items)})},test:function(){a["f"].GetRoleForEdit({id:2}).then(function(e){})},edit:function(e){var t=this;if(this.mdl=Object.assign({},e),this.mdl.permissions&&this.permissions){var n={};this.mdl.permissions.forEach(function(e){n[e.permissionId]=e.actionEntitySet.map(function(e){return e.action})}),console.log("permissionsAction",n),this.permissions.forEach(function(e){var i=n[e.id];e.selected=i||[],t.onChangeCheck(e)}),console.log("this.permissions",this.permissions)}this.$nextTick(function(){t.form.setFieldsValue(pick(t.mdl,"id","name","status","describe"))}),console.log("this.mdl",this.mdl)},onChangeCheck:function(e){e.indeterminate=!!e.selected.length&&e.selected.length<e.actionsOptions.length,e.checkedAll=e.selected.length===e.actionsOptions.length},onChangeCheckAll:function(e,t){Object.assign(t,{selected:e.target.checked?t.actionsOptions.map(function(e){return e.value}):[],indeterminate:!1,checkedAll:e.target.checked})},loadPermissions:function(e,t){var n=[],i=!0,s=!1,a=void 0;try{for(var r,o=function(){var i=r.value,s=i.name.lastIndexOf(".");if(-1==s){var a=e.filter(function(e){return e.name.startsWith(i.name+".")}),o=t&&t.filter(function(e){return e.startsWith(i.name+".")})||[],l=a.length==o.length,c=o.length>0&&o.length<a.length;n.push({name:i.displayName,value:i.name,checkedAll:l,selected:o,indeterminate:c,actionsOptions:a.map(function(e){return{label:e.displayName,value:e.name}})})}},l=e[Symbol.iterator]();!(i=(r=l.next()).done);i=!0)o()}catch(c){s=!0,a=c}finally{try{i||null==l.return||l.return()}finally{if(s)throw a}}this.permissions=n},save:function(){var e=this;this.form.validateFields(function(t,n){if(!t){var i=[],s=!0,r=!1,o=void 0;try{for(var l,c=e.permissions[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var d=l.value;d.selected&&d.selected.length&&(i.push(d.value),i=i.concat(d.selected))}}catch(t){r=!0,o=t}finally{try{s||null==c.return||c.return()}finally{if(r)throw o}}n.permissions=i,e.mdl.role?(n.id=e.mdl.role.id,a["f"].Update(n).then(function(){e.$message.success("保存成功")}).catch(function(t){var n=t.response.data;e.$message.error(n.error.message)})):a["f"].Create(n).then(function(){e.$message.success("保存成功")}).catch(function(t){var n=t.response.data;e.$message.error(n.error.message)})}}),console.log(this.permissions)}}},l=o,c=n("2877"),d=Object(c["a"])(l,i,s,!1,null,"66ed9965",null);t["default"]=d.exports}}]);